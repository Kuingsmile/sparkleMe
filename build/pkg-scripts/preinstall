#!/bin/sh

OLD_SYSPROXY="/Library/PrivilegedHelperTools/sparkleme.helper"

UNINSTALL=false

if [ ! -f "$OLD_SYSPROXY" ]; then
    UNINSTALL=true
fi

if [ "$UNINSTALL" = true ]; then
    if launchctl list | grep -q "sparkleme.helper"; then
        launchctl stop sparkleme.helper 2>/dev/null || true
        launchctl unload /Library/LaunchDaemons/sparkleme.helper.plist 2>/dev/null || true
    fi

    for file in "/Library/LaunchDaemons/sparkleme.helper.plist" \
               "/Library/PrivilegedHelperTools/sparkleme.helper" \
               "/tmp/sparkleme.helper" \
               "/tmp/sparkleme-helper.sock"; do
        if [ -e "$file" ]; then
            rm -f "$file"
        fi
    done
fi

exit 0
